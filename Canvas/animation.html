<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title></title>
    </head>
    <body>
        <canvas id="canvas" width="300" height="300"></canvas>
        <button type="button" name="button" class="start">开始</button>
        <button type="button" name="button" class="stop">暂停</button>
        <script>

            const $ = (el) => document.querySelector(el)
            const canvas = $('#canvas')
            const start = $('.start')
            const stop = $('.stop')
            const ctx = canvas.getContext('2d')
            ctx.fillStyle='red'
            let isPlay = false
            let x = 0
            start.addEventListener('click',function(){
                if(isPlay){
                    return
                }
                isPlay = true
                animate()
                addFlow()
            })
            stop.addEventListener('click',function(){
                if(!isPlay){
                    return
                }
                isPlay = false
                animate()
            })
            var arr = []
            for(var i=0;i<100;i++){
                arr.push({
                    'top':Math.random()*300,
                    'left':Math.random()*300,
                    'scale':Math.random()*4+3,
                    "deg":Math.random(-10,10)
                })
            }
            function d2a(n){
                return n*Math.PI/180
            }
            function animate(){
                if(isPlay){
                    ctx.clearRect(0,0,canvas.width,canvas.height)

                    for(let i=0;i<arr.length;i++){
                        var speed = 0.5 * arr[i].scale
                        arr[i].left = arr[i].left + Math.tan(d2a(arr[i].deg))*speed
                        arr[i].top = arr[i].top + speed

                        if(arr[i].top >= 300 || arr[i].left <0 || arr[i].left >= 300){
                            arr.splice(i--,1)
                            continue
                        }
                        ctx.beginPath();
                        ctx.arc(arr[i].left,arr[i].top,speed,0,2*Math.PI)
                        ctx.closePath()
                        ctx.fill();
                    }


                    setTimeout(animate,33)
                }
            }

            function addFlow(){
                if(arr.length < 150){
                    for(let i=0;i<10;i++){
                        arr.push({
                            'top':-Math.random()*50,
                            'left':Math.random()*300,
                            'scale':Math.random()*4+3,
                            "deg":Math.random(-10,10)
                        })
                    }
                }
                setTimeout(addFlow,60)
            }


        </script>
    </body>
</html>
